// The weapons in the store

const weaponsData = {
    "weapons": [
        {
            "name": "Knife",
            "description": "Don't buy. We are not Britain.",
            "hash": "WEAPON_KNIFE",
            "cost": 0.0
        },
        {
            "name": "Switchblade",
            "description": "Like a knife, but cooler",
            "hash": "WEAPON_SWITCHBLADE",
            "cost": 0.0
        },
        {
            "name": "Baseball Bat",
            "description": "I hope you are using this for baseball",
            "hash": "WEAPON_BAT",
            "cost": 0.0
        },
        {
            "name": "Crowbar",
            "description": "You are not Freeman Gordon from Full Life 3",
            "hash": "WEAPON_CROWBAR",
            "cost": 0.0
        },
        {
            "name": "Flashlight",
            "description": "Useful at night, when you are looking for Bigfoot",
            "hash": "WEAPON_FLASHLIGHT",
            "cost": 0.0
        },
        {
            "name": "Hammer",
            "description": "There are more of these then guns, quite useful for things",
            "hash": "WEAPON_HAMMER",
            "cost": 0.0
        },
        {
            "name": "Brass Knuckles",
            "description": "We smuggled this in from Italy, don't tell FAT",
            "hash": "WEAPON_KNUCKLE",
            "cost": 1.0
        },
        {
            "name": "Pistol",
            "description": "Stay strapped or get clapped",
            "hash": "WEAPON_PISTOL",
            "cost": 5.0
        },
        {
            "name": "Combat Pistol",
            "description": "Acquired from the local police station",
            "hash": "WEAPON_COMBATPISTOL",
            "cost": 5.0
        },
        {
            "name": "Feuer 18",
            "description": "It shoots 18 millimeter bullets. üòê",
            "hash": "WEAPON_APPISTOL",
            "cost": 5.5
        },
        {
            "name": "SNS Pistol",
            "description": "I know you are buying this to pocket carry",
            "hash": "WEAPON_SNSPISTOL",
            "cost": 2.5
        },
        {
            "name": "Pistol .50",
            "description": "You might break your wrist",
            "hash": "WEAPON_PISTOL50",
            "cost": 10.5
        },
        {
            "name": "Pistol MK2",
            "description": "A pistol but something makes it better",
            "hash": "WEAPON_PISTOL_MK2",
            "cost": 7.5
        },
        {
            "name": "Heavy Pistol",
            "description": "18 rounds of concealable freedom",
            "hash": "WEAPON_HEAVYPISTOL",
            "cost": 8.0
        },
        {
            "name": "Flaregun",
            "description": "Launches a flare, pretty bright if you have nice eyes",
            "hash": "WEAPON_FLAREGUN",
            "cost": 0.0
        },
        {
            "name": "Taser",
            "description": "Not so quiet and not so deadly",
            "hash": "WEAPON_STUNGUN",
            "cost": 5.5
        },
        {
            "name": "Magnum",
            "description": "Buy this to look cool",
            "hash": "WEAPON_REVOLVER",
            "cost": 20.5
        },
        {
            "name": "Big Iron",
            "description": "Big iron on his hip",
            "hash": "WEAPON_DOUBLEACTION",
            "cost": 1200.0
        },
        {
            "name": "Micro SMG",
            "description": "Don't come in with this if you are on trial",
            "hash": "WEAPON_MICROSMG",
            "cost": 25.0
        },
        {
            "name": "SMG",
            "description": "I heard you like 80s TRU movies",
            "hash": "WEAPON_SMG",
            "cost": 15.0
        },
        {
            "name": "Combat PDW",
            "description": "Personal Defense Liability at best",
            "hash": "WEAPON_COMBATPDW",
            "cost": 20.0
        },
        {
            "name": "Gusenberg Sweeper",
            "description": "Goes well with a trenchcoat",
            "hash": "WEAPON_GUSENBERG",
            "cost": 20.0
        },
        {
            "name": "Tactical Pistol",
            "description": "A full auto and tactical pistol",
            "hash": "WEAPON_TECPISTOL",
            "cost": 35.0
        },
        {
            "name": "Pump shotgun",
            "description": "Kicks like a horse but slaps hard",
            "hash": "WEAPON_PUMPSHOTGUN",
            "cost": 5.0
        },
        {
            "name": "Sawed-Off",
            "description": "I know why you want this... But I won't report you",
            "hash": "WEAPON_SAWNOFFSHOTGUN",
            "cost": 25.0
        },
        {
            "name": "Double Barreled Shotgun",
            "description": "The president told my to buy a double barreled shotgun",
            "hash": "WEAPON_DBSHOTGUN",
            "cost": 15.0
        },
        {
            "name": "Assault Shotgun",
            "description": "A Fom Feuer prototype weapon intended for use within special forces groups",
            "hash": "WEAPON_ASSAULTSHOTGUN",
            "cost": 25.0
        },
        {
            "name": "Bullpup Shotgun",
            "description": "We had some issues with grips breaking while your hand is in front of the barrel",
            "hash": "WEAPON_BULLPUPSHOTGUN",
            "cost": 25.0
        },
        {
            "name": "Combat Shotgun",
            "description": "Commonly found on military installations",
            "hash": "WEAPON_COMBATSHOTGUN",
            "cost": 25.0
        },
        {
            "name": "Musket",
            "description": "Just as the founding fathers intended",
            "hash": "WEAPON_MUSKET",
            "cost": 2.0
        },
        {
            "name": "Assault Rifle",
            "description": "Soviet classic",
            "hash": "WEAPON_ASSAULTRIFLE",
            "cost": 25.0
        },
        {
            "name": "Carbine Rifle",
            "description": "Civilian version of military-issued carbines",
            "hash": "WEAPON_CARBINERIFLE",
            "cost": 25.0
        },
        {
            "name": "Heavy Rifle",
            "description": "Vom Feuer's latest rifle intended for use within Merryweather",
            "hash": "WEAPON_HEAVYRIFLE",
            "cost": 25.0
        },
        {
            "name": "Tactical Rifle",
            "description": "This is 'nam",
            "hash": "WEAPON_TACTICALRIFLE",
            "cost": 25.0
        },
        {
            "name": "Special Carbine",
            "description": "This appeared in our inventory",
            "hash": "WEAPON_SPECIALCARBINE",
            "cost": 25.0
        },
        {
            "name": "Sniper Rifle",
            "description": "Good for getting marshals called on you",
            "hash": "WEAPON_SNIPERRIFLE",
            "cost": 50.0
        },
        {
            "name": "Heavy Sniper",
            "description": "Really good for getting marshals called on you",
            "hash": "WEAPON_HEAVYSNIPER",
            "cost": 75.0
        },
        {
            "name": "Molotov Cocktail",
            "description": "Throw a monkey wrench into a peaceful protest",
            "hash": "WEAPON_MOLOTOV",
            "cost": 10.0
        },
        {
            "name": "Flare",
            "description": "Good for showing people where you are at",
            "hash": "WEAPON_FLARE",
            "cost": 0.0
        },
        {
            "name": "RPG",
            "description": "ŸÑÿß ÿ™ÿ¥ÿ™ÿ±Ÿä Ÿáÿ∞ÿß",
            "hash": "WEAPON_RPG",
            "cost": 450.0
        },
        {
            "name": "Homing RPG",
            "description": "Acquired legally from military surplus stores",
            "hash": "WEAPON_HOMINGLAUNCHER",
            "cost": 900.0
        },
        {
            "name": "Grenade Launcher",
            "description": "Thump thump thump",
            "hash": "WEAPON_GRENADELAUNCHER",
            "cost": 350.0
        },
        {
            "name": "Minigun",
            "description": "A minigun that is usually mounted onto helicopters.",
            "hash": "WEAPON_MINIGUNBROKENHASH",
            "cost": 8500000.0
        },
        {
            "name": "Fire Extinguisher",
            "description": "Puts out fires",
            "hash": "WEAPON_FIREEXTINGUISHER",
            "cost": 0.0
        }
    ]
}

// Create the weapon elements in HTML

function createWeapons(){
    let store = document.getElementById("contents")
    for (let i = 0; i < weaponsData.weapons.length; i++){
        var item = document.createElement("ul")
        item.innerHTML = `
        <li data-weapon-hash="${weaponsData.weapons[i].hash}" data-weapon-cost="${weaponsData.weapons[i].cost}" class="weapon">
            <div class="weapon-info">
                <h2>${weaponsData.weapons[i].name + " $" + weaponsData.weapons[i].cost}</h2>
                <p>${weaponsData.weapons[i].description}</p>
            </div>
            <button class="purchase-button">+</button>
        </li>`
        store.appendChild(item)
    }
}

createWeapons()

// Handle the opening and closing of the store
var useNotifs = false

var notyf = new Notyf({
    position: {
        x: 'left',
        y: 'center'
    },
    types: [
        {
            type: 'info',
            background: '#005288',
            duration: 5000,
            dismissible: false,
            icon: false,
            ripple: false,
        }
    ]
})

window.addEventListener('message', (event) => {
    if (event.data.type == 'open') {
        document.getElementById('store').style.visibility = "visible"
    }
    if (event.data.type == 'close') {
        document.getElementById('store').style.visibility = "hidden"
    }
    if (event.data.type == "initializeMenu") {
        useNotifs = event.data.useNotifications
    }
})
document.getElementById("close-button").addEventListener("click", (event) => {
    fetch(`https://${GetParentResourceName()}/closeammunation`, {
        method: "POST",
        headers: {
            'Content-Type': 'application/json; charset=UTF-8',
        },
        body: JSON.stringify({})
    }).then(resp => resp.json())
})

// Handle the purchasing of weapons

let weapons = document.getElementsByClassName("weapon")
let purchaseButtons = document.getElementsByClassName("purchase-button")
for (let x = 0; x < purchaseButtons.length; x++){
    purchaseButtons[x].addEventListener("click", (event) => {
        let weaponHash = weapons[x].dataset.weaponHash
        let weaponCost = Number(weapons[x].dataset.weaponCost)
        fetch(`https://${GetParentResourceName()}/giveweaponammunation`, {
        method: "POST",
        headers: {
            'Content-Type': 'application/json; charset=UTF-8',
        },
        body: JSON.stringify({
            weapon: weaponHash,
            weaponCost: weaponCost
        })
        }).then(resp => resp.json())
    })
}